<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>合成大多米</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #fdf6e3; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; touch-action: none; }
        #score-ui { position: absolute; top: 5%; font-size: 24px; font-weight: bold; color: #657b83; z-index: 10; pointer-events: none; }
        #ui-layer { position: absolute; z-index: 100; text-align: center; background: rgba(253, 246, 227, 0.9); width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        button { padding: 15px 40px; font-size: 20px; cursor: pointer; background: #859900; color: white; border: none; border-radius: 10px; box-shadow: 0 4px #586e75; }
        #game-container { width: 100vw; height: 100vh; max-width: 450px; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<div id="score-ui">得分: <span id="score-num">0</span></div>

<div id="ui-layer">
    <h1 style="color: #657b83; margin-bottom: 20px;">合成大多米</h1>
    <button id="start-btn">开始挑战</button>
</div>

<div id="game-container"></div>

<script>
let score = 0;
let isGameActive = false;
let currentCat = null;
let catsGroup;
let canInput = false;
let startTime = 0; // 记录开始时间避免误判结束
const DEADLINE_Y = 120;
const GAME_WIDTH = 450;
const GAME_HEIGHT = 700;

const config = {
    type: Phaser.AUTO,
    width: GAME_WIDTH,
    height: GAME_HEIGHT,
    parent: 'game-container',
    backgroundColor: '#fdf6e3',
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
    physics: { default: 'arcade', arcade: { gravity: { y: 1000 }, debug: false } },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);

function preload() {} // 暂时不需要加载外部图片

function create() {
    const self = this;
    const colors = [0xff7f7f, 0x7fbf7f, 0x7f7fbf, 0xbfbf7f, 0xbf7fbf, 0x7fbfbf, 0xffb347, 0xb19cd9, 0xff6961];

    // 生成纹理
    for (let i = 1; i <= 9; i++) {
        const graphics = this.make.graphics({ x: 0, y: 0, add: false });
        graphics.fillStyle(colors[i-1], 1);
        graphics.fillCircle(50, 50, 50);
        graphics.generateTexture(`cat${i}`, 100, 100);
    }

    // 警戒线
    const line = this.add.graphics();
    line.lineStyle(2, 0xff4444, 0.5);
    for (let i = 0; i < GAME_WIDTH; i += 10) { line.lineBetween(i, DEADLINE_Y, i + 5, DEADLINE_Y); }

    catsGroup = this.physics.add.group();

    // 碰撞合成逻辑
    this.physics.add.collider(catsGroup, catsGroup, (o1, o2) => {
        if (o1.level === o2.level && o1.level < 9 && !o1.isMerging && !
